<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Drive Control Panel</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/pitchrollgauges.css">
    <!-- Bootstrap Icons for the question mark -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        #bluetoothdevicesList {
    list-style: none;
    padding: 0;
}

.device-item {
    padding: 10px;
    border-bottom: 1px solid #ccc;
}

.device-item:hover {
    background-color: #f0f0f0;
}
</style>
</head>
<body>

<!-- Top Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <!-- Menu Icon -->
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu" aria-controls="offcanvasMenu" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="#">Dynamic Drive</a>
    </div>
</nav>

<!-- Offcanvas Menu -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasMenu" aria-labelledby="offcanvasMenuLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasMenuLabel">Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <ul class="list-group">
            <li class="list-group-item">
                <a href="index.html">Dashboard</a>
            </li>
            <li class="list-group-item">
                <a href="suspension.html">Suspension</a>
            </li>
            <li class="list-group-item">
                <a href="lights.html">Lights</a>
            </li>
            <li class="list-group-item">
                <a href="setup.html">Setup</a>
            </li>
            <li class="list-group-item">
                <a href="blank_page.html">Blank Page</a>
            </li>
            <li class="list-group-item">
                <a href="mk-suspension.html">MobileKit</a>
            </li>
        </ul>
    </div>
</div>

<!-- Main Content -->
<div class="container my-4">
    <h3>Dashboard</h3>
    <!-- Updated Responsive Gauge Container -->
    <div class="gauge-container">
        <!-- Roll Circle -->
        <div class="circle-container">
            <div class="circle" id="roll-circle">
                <div class="sky"></div>
                <div class="ground"></div>
                <div class="groundneedle"></div>
                <div class="skyneedle"></div>
                <img src="images/truck-side.png" class="truck-icon-side" alt="Truck Side">
            </div>
            <div class="degree-display" id="roll-degree">0°</div>
        </div>

        <!-- Pitch Circle -->
        <div class="circle-container">
            <div class="circle" id="pitch-circle">
                <div class="sky"></div>
                <div class="ground"></div>
                <div class="groundneedle"></div>
                <div class="skyneedle"></div>
                <img src="images/truck-front.png" class="truck-icon-front" alt="Truck Front">
            </div>
            <div class="degree-display" id="pitch-degree">0°</div>
        </div>
    </div>
</div>

<div class="container my-4">
    <div class="d-grid gap-2">
        <p>Placeholder for MPU6050 data and chassis orientation visualization.</p>
        <button class="btn btn-success" type="button" onclick="connectToESP32()">Connect to ESP32</button>
        <button class="btn btn-warning" type="button" onclick="sendDataToESP32('command', 'test')">Send Test Data</button>
        <button class="btn btn-info" type="button" onclick="disconnectFromESP32()">Disconnect</button>
        <button onclick="startBluetoothDiscovery()">Discover Devices</button>
    
    </div>
</div>

<div class="container my-4">
    <div class="d-grid gap-2">
        <ul id="deviceList"></ul>
    </div>
</div>
<!-- <div class="d-grid gap-2">
  
</div> -->


<!-- <footer class="footer">
    <div class="container">
      <p class="mb-0">Savage Cat Solutions &copy;2020 - <span id="currentYear"></span></p>
    </div>
  </footer> -->
<!-- Bootstrap 5 JS and dependencies (Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<!-- script for the pitch/roll gauges -->
<script src="js/pitchrollgauges.js"></script>
<script>
    // Initialize all tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl, {
            trigger: 'click'
        })
    });

    function init(){
        getCurrentYearForCopy();
		// connectToESP32();
    }

    function getCurrentYearForCopy(){
        const d = new Date();
        let year = d.getFullYear();
        document.getElementById("currentYear").innerHTML = year;
    }

    // Functions to connect and disconnect from Bluetooth device
        function startBluetoothDiscovery() {
            document.getElementById("deviceList").innerHTML = "<em>Searching...</em>"
            BluetoothInterface.startDeviceDiscovery();
        }

        function handleDiscoveredDevices(devicesJson) {
            const devices = JSON.parse(devicesJson);
            const deviceList = document.getElementById("deviceList");

            // Clear any previous entries
            deviceList.innerHTML = "";

            // Create list items for each device
            devices.forEach(device => {
                const listItem = document.createElement("li");
                listItem.textContent = `${device.name} (${device.address})`;
                // listItem.textContent = `${device.name}`;

                // Add a click listener to connect to the device when clicked
                listItem.addEventListener("click", () => {
                    BluetoothInterface.connectToDevice(device.address);
                });

                deviceList.appendChild(listItem);
            });
        }



        function connectToDevice(address) {
            console.log("Attempting to connect to device:", address);
            BluetoothInterface.connectToDevice(address);
        }



    function handleBluetoothData(responseData) {
        console.log("Data from ESP32:", responseData);
        // Process the data received from ESP32
    }


    function connectToESP32() {

        if (BluetoothInterface.isConnected()) {
            console.log("Already connected to ESP32.");
            return; // Skip connection if already connected
        } else {
            const macAddress = "08:A6:F7:B1:A4:D6"; // Replace with your actual ESP32 MAC address
            console.log("Attempting to connect to macAddress: " + macAddress);
            // alert("Attempting to connect to: " + macAddress);
            BluetoothInterface.connectToDevice(macAddress);
        }
    }

    function sendDataToESP32(key, value) {
        console.log(key)
        console.log(value);
        console.log("Send button clicked");
        const data = JSON.stringify({ [key]: value });
        BluetoothInterface.sendData(data);
    }

    function disconnectFromESP32() {
        console.log("Disconnect button clicked");
        BluetoothInterface.disconnect();
    }

    function resetGyro() {
        const key = "mpureset";
        const value = 1;
        console.log("Reset Gyro button clicked");
        const data = JSON.stringify({ [key]: value });
        BluetoothInterface.sendData(data);
    }

    init();
</script>
</body>
</html>
